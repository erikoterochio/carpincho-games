<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>El Impostor · Carpincho Games</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    :root {
      --bg: #0A092C;
      --pink: #FF6B6B;
      --blue: #335C81;
      --indigo: #1B2845;
      --sky: #5899E2;
      --card: #ffffff;
      --text: #1B2845;
      --muted: #6b7280;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 480px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.03);
      padding: 14px 14px 12px;
      border: 1px solid rgba(27, 40, 69, 0.1);
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
    }

    .title-group h1 {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--indigo);
    }

    .back-link {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--indigo);
      text-decoration: none;
      border-radius: 999px;
      border: 1px solid rgba(51, 92, 129, 0.3);
      padding: 6px 14px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #ffffff;
      white-space: nowrap;
    }

    .back-link:hover {
      background: #f9f9f9;
      border-color: var(--blue);
    }

    .content {
      background: #f8f9fa;
      border-radius: 16px;
      padding: 20px 16px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .intro-text {
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 20px;
    }

    .btn {
      width: 100%;
      padding: 14px 20px;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    .btn-primary {
      background: var(--sky);
      color: #ffffff;
      border: 2px solid var(--sky);
    }

    .btn-primary:hover {
      background: #4a8dd4;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(88, 153, 226, 0.3);
    }

    .btn-secondary {
      background: #ffffff;
      color: var(--indigo);
      border: 2px solid rgba(51, 92, 129, 0.3);
    }

    .btn-secondary:hover {
      background: #f9f9f9;
      border-color: var(--blue);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .instructions {
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text);
    }

    .instructions h3 {
      font-size: 1.05rem;
      margin-top: 16px;
      margin-bottom: 8px;
      color: var(--sky);
    }

    .instructions p {
      margin-bottom: 12px;
    }

    .step-list {
      list-style: none;
      padding: 0;
      margin-bottom: 12px;
    }

    .step-list li {
      display: flex;
      gap: 12px;
      margin-bottom: 10px;
      align-items: flex-start;
    }

    .step-number {
      min-width: 24px;
      font-weight: 700;
      color: var(--sky);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--indigo);
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid rgba(148, 163, 184, 0.3);
      border-radius: 10px;
      font-size: 1rem;
      background: #ffffff;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--sky);
    }

    .player-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .inline-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .info-text {
      font-size: 1.15rem;
      line-height: 1.6;
      text-align: center;
      color: var(--text);
      margin-bottom: 20px;
    }

    .info-text.large {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--indigo);
    }

    .word-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 24px;
      text-align: center;
      border: 3px solid var(--sky);
      margin: 20px 0;
    }

    .word-card.impostor {
      border-color: var(--pink);
    }

    .secret-word {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--indigo);
      margin: 16px 0;
    }

    .secret-word.impostor {
      color: var(--pink);
    }

    .player-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 16px 0;
    }

    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      background: #ffffff;
      border-radius: 10px;
      border: 2px solid rgba(148, 163, 184, 0.3);
    }

    .player-item.active {
      border-color: var(--sky);
      background: #e0f2fe;
    }

    .player-item.eliminated {
      opacity: 0.5;
      text-decoration: line-through;
    }

    .player-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--indigo);
    }

    .timer {
      font-size: 3rem;
      font-weight: 700;
      text-align: center;
      color: var(--pink);
      margin: 24px 0;
      font-variant-numeric: tabular-nums;
    }

    .vote-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 20px 0;
    }

    .vote-btn {
      padding: 16px;
      background: #ffffff;
      border: 2px solid rgba(148, 163, 184, 0.3);
      border-radius: 10px;
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--indigo);
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: left;
    }

    .vote-btn:hover {
      border-color: var(--sky);
      background: #e0f2fe;
      transform: translateX(4px);
    }

    .vote-btn:active {
      transform: scale(0.98);
    }

    .scoreboard {
      margin: 20px 0;
    }

    .score-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #ffffff;
      border-radius: 10px;
      margin-bottom: 8px;
      border: 2px solid rgba(148, 163, 184, 0.3);
    }

    .score-item.winner {
      border-color: var(--sky);
      background: #e0f2fe;
    }

    .score-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--indigo);
    }

    .score-points {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--sky);
    }

    .result-box {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px 20px;
      text-align: center;
      margin: 20px 0;
      border: 3px solid var(--sky);
    }

    .result-box.impostor {
      border-color: var(--pink);
    }

    .result-box h3 {
      font-size: 1.1rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .result-box .big-text {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--indigo);
      margin: 8px 0;
    }

    .result-box .role-text {
      font-size: 1.3rem;
      font-weight: 700;
      margin-top: 8px;
    }

    .role-text.citizen {
      color: var(--sky);
    }

    .role-text.impostor {
      color: var(--pink);
    }

    footer {
      margin-top: 12px;
      font-size: 0.75rem;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .app {
        padding: 12px 10px 10px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <!-- PANTALLA 1: INICIO -->
    <div class="screen active" id="screen-home">
      <header>
        <div class="title-group">
          <h1>El Impostor</h1>
        </div>
        <a href="index.html" class="back-link">← Inicio</a>
      </header>

      <div class="content">
        <p class="intro-text">
          Usen un solo celular.<br>
          La app se ocupa de la palabra, los roles, el orden y la votación.
        </p>
        
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showScreen('screen-instructions')">Cómo se juega</button>
          <button class="btn btn-primary" onclick="showScreen('screen-setup')">Jugar</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 2: INSTRUCCIONES -->
    <div class="screen" id="screen-instructions">
      <header>
        <div class="title-group">
          <h1>Cómo se juega</h1>
        </div>
        <button class="back-link" onclick="showScreen('screen-home')" style="border:none;background:transparent;cursor:pointer;">← Volver</button>
      </header>

      <div class="content">
        <div class="instructions">
          <p>Uno o más jugadores son impostores y no conocen la palabra secreta. Todos dan pistas en voz alta y luego votan quién creen que miente.</p>
          
          <ul class="step-list">
            <li>
              <span class="step-number">1.</span>
              <span>Configuran jugadores, impostores y categoría de palabra.</span>
            </li>
            <li>
              <span class="step-number">2.</span>
              <span>El celular se pasa y cada uno ve su palabra (o descubre que es impostor).</span>
            </li>
            <li>
              <span class="step-number">3.</span>
              <span>Todos dan pistas en orden (pueden ser varias vueltas).</span>
            </li>
            <li>
              <span class="step-number">4.</span>
              <span>Discusión con tiempo limitado.</span>
            </li>
            <li>
              <span class="step-number">5.</span>
              <span>Votación abierta para eliminar a un jugador.</span>
            </li>
            <li>
              <span class="step-number">6.</span>
              <span>Si quedan impostores y vueltas, se repite. Si no, termina la ronda.</span>
            </li>
          </ul>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="showScreen('screen-home')">Entendido</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 3: CONFIGURACIÓN -->
    <div class="screen" id="screen-setup">
      <header>
        <div class="title-group">
          <h1>Configurar Partida</h1>
        </div>
        <button class="back-link" onclick="showScreen('screen-home')" style="border:none;background:transparent;cursor:pointer;">← Volver</button>
      </header>

      <div class="content">
        <form id="setup-form" onsubmit="startGame(event)">
          <div class="inline-group">
            <div class="form-group">
              <label>Jugadores</label>
              <select id="player-count" onchange="updatePlayerInputs()">
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected>5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
              </select>
            </div>

            <div class="form-group">
              <label>Impostores</label>
              <select id="impostor-count">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Nombres de jugadores</label>
            <div class="player-inputs" id="player-names-container"></div>
          </div>

          <div class="form-group">
            <label>Categoría de palabra</label>
            <select id="word-category">
              <option value="mixto" selected>Mixto</option>
              <option value="comida">Comida</option>
              <option value="peliculas">Películas</option>
              <option value="lugares">Lugares</option>
              <option value="objetos">Objetos</option>
            </select>
          </div>

          <div class="inline-group">
            <div class="form-group">
              <label>Vueltas de pistas</label>
              <select id="clue-rounds">
                <option value="1" selected>1 vuelta</option>
                <option value="2">2 vueltas</option>
                <option value="3">3 vueltas</option>
              </select>
            </div>

            <div class="form-group">
              <label>Tiempo votación</label>
              <select id="vote-time">
                <option value="30">30 seg</option>
                <option value="60" selected>1 min</option>
                <option value="90">1:30 min</option>
                <option value="120">2 min</option>
              </select>
            </div>
          </div>

          <div class="btn-group">
            <button type="submit" class="btn btn-primary">Empezar Partida</button>
          </div>
        </form>
      </div>
    </div>

    <!-- PANTALLA 4: PASAR CELULAR PARA VER PALABRA -->
    <div class="screen" id="screen-pass-phone">
      <header>
        <div class="title-group">
          <h1>Revelar Palabra</h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text large" id="pass-phone-text">Pasá el celular a [Jugador]</p>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="showWord()">Mostrar palabra</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 5: MOSTRAR PALABRA/IMPOSTOR -->
    <div class="screen" id="screen-show-word">
      <header>
        <div class="title-group">
          <h1 id="word-header">Tu Palabra</h1>
        </div>
      </header>

      <div class="content">
        <div class="word-card" id="word-card">
          <div class="secret-word" id="word-display"></div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="nextPlayerWord()">Listo, siguiente jugador</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 6: INICIAR RONDA DE PISTAS -->
    <div class="screen" id="screen-start-clues">
      <header>
        <div class="title-group">
          <h1>Iniciar Pistas</h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text">Todos recibieron su palabra (o descubrieron que son impostores).</p>
        <p class="info-text">Empieza <strong id="first-player-name" style="color:var(--sky);"></strong> dando una pista en voz alta.</p>
        <p class="info-text" style="font-size:0.95rem;color:var(--muted);">El resto continúa en orden hacia la derecha.</p>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="startClueTracking()">Iniciar ronda de pistas</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 7: SEGUIMIENTO DE PISTAS -->
    <div class="screen" id="screen-clues">
      <header>
        <div class="title-group">
          <h1>Pistas - Vuelta <span id="current-clue-round">1</span>/<span id="total-clue-rounds">1</span></h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text">Turno de: <strong id="current-clue-player" style="color:var(--sky);">Jugador</strong></p>
        
        <div class="player-list" id="clue-player-list"></div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="nextClue()">Siguiente</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 8: VOTACIÓN CON TIMER -->
    <div class="screen" id="screen-vote-timer">
      <header>
        <div class="title-group">
          <h1>Discusión</h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text">Discutan quién creen que es el impostor</p>

        <div class="timer" id="vote-timer">01:00</div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="skipToVote()">Ir a votación</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 9: VOTACIÓN ABIERTA -->
    <div class="screen" id="screen-vote">
      <header>
        <div class="title-group">
          <h1>Votación</h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text">¿Quién fue el elegido por el grupo?</p>

        <div class="vote-grid" id="vote-buttons"></div>
      </div>
    </div>

    <!-- PANTALLA 10: RESULTADO DE VOTACIÓN -->
    <div class="screen" id="screen-vote-result">
      <header>
        <div class="title-group">
          <h1>Resultado</h1>
        </div>
      </header>

      <div class="content">
        <div class="result-box" id="result-box">
          <h3>Eliminado:</h3>
          <div class="big-text" id="eliminated-player-name">Jugador</div>
          <div class="role-text" id="eliminated-player-role">CIUDADANO</div>
        </div>

        <p class="info-text" id="game-status-text" style="font-size:1rem;"></p>

        <div class="btn-group" id="result-buttons"></div>
      </div>
    </div>

    <!-- PANTALLA 11: FIN DE RONDA -->
    <div class="screen" id="screen-end-round">
      <header>
        <div class="title-group">
          <h1>Ronda Terminada</h1>
        </div>
      </header>

      <div class="content">
        <div class="result-box">
          <h3 id="round-winner-text">Ganaron los Ciudadanos</h3>
          <p style="margin-top:12px;font-size:0.95rem;color:var(--muted);" id="round-summary"></p>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="showPlayAgainOptions()">Jugar otra ronda</button>
        </div>
      </div>
    </div>

    <!-- PANTALLA 12: OPCIONES PARA JUGAR DE NUEVO -->
    <div class="screen" id="screen-play-again">
      <header>
        <div class="title-group">
          <h1>Nueva Ronda</h1>
        </div>
      </header>

      <div class="content">
        <p class="info-text">¿Qué querés hacer?</p>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="repeatAll()">Repetir todo igual</button>
          <button class="btn btn-secondary" onclick="changeCategory()">Cambiar solo categoría</button>
          <button class="btn btn-secondary" onclick="changeConfig()">Cambiar configuración</button>
        </div>
      </div>
    </div>

    <footer>
      <span>Carpincho Games · El Impostor</span>
    </footer>
  </main>

  <script>
    // Estado del juego
    const gameState = {
      players: [],
      eliminated: [],
      impostorCount: 1,
      wordCategory: 'mixto',
      word: '',
      roles: [],
      impostorIndexes: [],
      currentPlayerIndex: 0,
      clueRounds: 1,
      currentClueRound: 1,
      currentClueIndex: 0,
      voteTime: 60,
      firstPlayerIndex: 0
    };

    // Diccionario de palabras
    const wordBank = {
      comida: ['Pizza', 'Asado', 'Empanada', 'Milanesa', 'Pasta', 'Sushi', 'Hamburguesa', 'Helado', 'Choripán', 'Facturas', 'Mate', 'Dulce de leche', 'Alfajor', 'Locro', 'Ravioles'],
      peliculas: ['Titanic', 'Avatar', 'Gladiador', 'Matrix', 'Inception', 'Interestelar', 'Rocky', 'Terminator', 'Batman', 'Superman', 'Joker', 'Frozen', 'Coco', 'Up', 'Toy Story'],
      lugares: ['París', 'Roma', 'Londres', 'Tokio', 'Nueva York', 'Buenos Aires', 'Barcelona', 'Venecia', 'Ámsterdam', 'Berlín', 'Madrid', 'Playa', 'Montaña', 'Bosque', 'Desierto'],
      objetos: ['Celular', 'Computadora', 'Reloj', 'Libro', 'Lapicera', 'Llave', 'Espejo', 'Lámpara', 'Almohada', 'Mochila', 'Guitarra', 'Pelota', 'Bicicleta', 'Cámara', 'Auriculares'],
      mixto: ['Pizza', 'París', 'Titanic', 'Celular', 'Guitarra', 'Fútbol', 'Playa', 'Montaña', 'Perro', 'Café', 'Música', 'Verano', 'Lluvia', 'Sol', 'Luna']
    };

    let voteTimer = null;
    const STORAGE_KEY = 'impostor_config';
    const STORAGE_EXPIRY = 2 * 60 * 60 * 1000; // 2 horas

    // Navegación entre pantallas
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    // Guardar configuración
    function saveConfig() {
      const config = {
        playerCount: document.getElementById('player-count').value,
        impostorCount: document.getElementById('impostor-count').value,
        wordCategory: document.getElementById('word-category').value,
        clueRounds: document.getElementById('clue-rounds').value,
        voteTime: document.getElementById('vote-time').value,
        timestamp: Date.now()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
    }

    // Cargar configuración
    function loadConfig() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;
      
      try {
        const config = JSON.parse(saved);
        if (Date.now() - config.timestamp > STORAGE_EXPIRY) {
          localStorage.removeItem(STORAGE_KEY);
          return;
        }
        
        document.getElementById('player-count').value = config.playerCount;
        document.getElementById('impostor-count').value = config.impostorCount;
        document.getElementById('word-category').value = config.wordCategory;
        document.getElementById('clue-rounds').value = config.clueRounds;
        document.getElementById('vote-time').value = config.voteTime;
        updatePlayerInputs();
      } catch (e) {
        localStorage.removeItem(STORAGE_KEY);
      }
    }

    // Actualizar inputs de jugadores
    function updatePlayerInputs() {
      const count = parseInt(document.getElementById('player-count').value);
      const container = document.getElementById('player-names-container');
      container.innerHTML = '';
      
      for (let i = 0; i < count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Jugador ${i + 1}`;
        input.id = `player-${i}`;
        container.appendChild(input);
      }
    }

    // Iniciar juego
    function startGame(event) {
      event.preventDefault();
      
      const playerCount = parseInt(document.getElementById('player-count').value);
      gameState.players = [];
      
      for (let i = 0; i < playerCount; i++) {
        const name = document.getElementById(`player-${i}`).value.trim() || `Jugador ${i + 1}`;
        gameState.players.push(name);
      }
      
      gameState.impostorCount = parseInt(document.getElementById('impostor-count').value);
      gameState.wordCategory = document.getElementById('word-category').value;
      gameState.clueRounds = parseInt(document.getElementById('clue-rounds').value);
      gameState.voteTime = parseInt(document.getElementById('vote-time').value);
      gameState.eliminated = [];
      gameState.firstPlayerIndex = 0;
      
      saveConfig();
      assignRoles();
      gameState.currentPlayerIndex = 0;
      showPassPhoneScreen();
    }

    // Asignar roles y palabra
    function assignRoles() {
      const words = wordBank[gameState.wordCategory];
      gameState.word = words[Math.floor(Math.random() * words.length)];
      
      const activeIndexes = gameState.players
        .map((p, i) => i)
        .filter(i => !gameState.eliminated.includes(i));
      
      gameState.roles = new Array(gameState.players.length).fill('citizen');
      gameState.impostorIndexes = [];
      
      const shuffled = [...activeIndexes].sort(() => Math.random() - 0.5);
      const impostorCount = Math.min(gameState.impostorCount, activeIndexes.length - 1);
      
      for (let i = 0; i < impostorCount; i++) {
        const idx = shuffled[i];
        gameState.roles[idx] = 'impostor';
        gameState.impostorIndexes.push(idx);
      }
    }

    // Mostrar pantalla de pasar celular
    function showPassPhoneScreen() {
      if (gameState.currentPlayerIndex >= gameState.players.length) {
        showStartCluesScreen();
        return;
      }
      
      if (gameState.eliminated.includes(gameState.currentPlayerIndex)) {
        gameState.currentPlayerIndex++;
        showPassPhoneScreen();
        return;
      }
      
      const playerName = gameState.players[gameState.currentPlayerIndex];
      document.getElementById('pass-phone-text').textContent = `Pasá el celular a ${playerName}`;
      showScreen('screen-pass-phone');
    }

    // Mostrar palabra
    function showWord() {
      const role = gameState.roles[gameState.currentPlayerIndex];
      const wordCard = document.getElementById('word-card');
      const wordDisplay = document.getElementById('word-display');
      const wordHeader = document.getElementById('word-header');
      
      if (role === 'impostor') {
        wordCard.classList.add('impostor');
        wordDisplay.className = 'secret-word impostor';
        wordDisplay.textContent = 'IMPOSTOR';
        wordHeader.textContent = 'Tu Rol';
      } else {
        wordCard.classList.remove('impostor');
        wordDisplay.className = 'secret-word';
        wordDisplay.textContent = gameState.word;
        wordHeader.textContent = 'Tu Palabra';
      }
      
      showScreen('screen-show-word');
    }

    // Siguiente jugador
    function nextPlayerWord() {
      gameState.currentPlayerIndex++;
      showPassPhoneScreen();
    }

    // Mostrar pantalla de inicio de pistas
    function showStartCluesScreen() {
      const activePlayers = gameState.players.filter((p, i) => !gameState.eliminated.includes(i));
      let firstIndex = gameState.firstPlayerIndex;
      
      while (gameState.eliminated.includes(firstIndex)) {
        firstIndex = (firstIndex + 1) % gameState.players.length;
      }
      gameState.firstPlayerIndex = firstIndex;
      
      document.getElementById('first-player-name').textContent = gameState.players[firstIndex];
      showScreen('screen-start-clues');
    }

    // Iniciar seguimiento de pistas
    function startClueTracking() {
      gameState.currentClueRound = 1;
      gameState.currentClueIndex = gameState.firstPlayerIndex;
      updateClueScreen();
      showScreen('screen-clues');
    }

    // Actualizar pantalla de pistas
    function updateClueScreen() {
      document.getElementById('current-clue-round').textContent = gameState.currentClueRound;
      document.getElementById('total-clue-rounds').textContent = gameState.clueRounds;
      document.getElementById('current-clue-player').textContent = gameState.players[gameState.currentClueIndex];
      
      const list = document.getElementById('clue-player-list');
      list.innerHTML = '';
      
      gameState.players.forEach((player, idx) => {
        if (gameState.eliminated.includes(idx)) return;
        
        const item = document.createElement('div');
        item.className = 'player-item';
        if (idx === gameState.currentClueIndex) {
          item.classList.add('active');
        }
        item.innerHTML = `
          <span class="player-name">${player}</span>
          <span style="color:var(--muted);">${idx === gameState.currentClueIndex ? '← Turno actual' : ''}</span>
        `;
        list.appendChild(item);
      });
    }

    // Siguiente pista
    function nextClue() {
      do {
        gameState.currentClueIndex = (gameState.currentClueIndex + 1) % gameState.players.length;
      } while (gameState.eliminated.includes(gameState.currentClueIndex));
      
      const activePlayers = gameState.players.filter((p, i) => !gameState.eliminated.includes(i));
      const activeStartIndex = gameState.players.indexOf(gameState.players.find((p, i) => !gameState.eliminated.includes(i) && i >= gameState.firstPlayerIndex)) >= 0
        ? gameState.players.indexOf(gameState.players.find((p, i) => !gameState.eliminated.includes(i) && i >= gameState.firstPlayerIndex))
        : gameState.players.findIndex((p, i) => !gameState.eliminated.includes(i));
      
      if (gameState.currentClueIndex === gameState.firstPlayerIndex && gameState.currentClueRound < gameState.clueRounds) {
        gameState.currentClueRound++;
        updateClueScreen();
      } else if (gameState.currentClueIndex === gameState.firstPlayerIndex && gameState.currentClueRound >= gameState.clueRounds) {
        startVoteTimer();
      } else {
        updateClueScreen();
      }
    }

    // Iniciar timer de votación
    function startVoteTimer() {
      let timeLeft = gameState.voteTime;
      const timerEl = document.getElementById('vote-timer');
      
      const mins = Math.floor(timeLeft / 60);
      const secs = timeLeft % 60;
      timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      
      showScreen('screen-vote-timer');
      
      if (voteTimer) clearInterval(voteTimer);
      
      voteTimer = setInterval(() => {
        timeLeft--;
        const mins = Math.floor(timeLeft / 60);
        const secs = timeLeft % 60;
        timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
          clearInterval(voteTimer);
          showVoteScreen();
        }
      }, 1000);
    }

    // Saltar a votación
    function skipToVote() {
      if (voteTimer) clearInterval(voteTimer);
      showVoteScreen();
    }

    // Mostrar pantalla de votación
    function showVoteScreen() {
      const container = document.getElementById('vote-buttons');
      container.innerHTML = '';
      
      gameState.players.forEach((player, idx) => {
        if (gameState.eliminated.includes(idx)) return;
        
        const btn = document.createElement('button');
        btn.className = 'vote-btn';
        btn.textContent = player;
        btn.onclick = () => eliminatePlayer(idx);
        container.appendChild(btn);
      });
      
      showScreen('screen-vote');
    }

    // Eliminar jugador
    function eliminatePlayer(idx) {
      gameState.eliminated.push(idx);
      const role = gameState.roles[idx];
      const playerName = gameState.players[idx];
      
      const resultBox = document.getElementById('result-box');
      document.getElementById('eliminated-player-name').textContent = playerName;
      const roleEl = document.getElementById('eliminated-player-role');
      
      if (role === 'impostor') {
        roleEl.textContent = 'IMPOSTOR';
        roleEl.className = 'role-text impostor';
        resultBox.classList.add('impostor');
      } else {
        roleEl.textContent = 'CIUDADANO';
        roleEl.className = 'role-text citizen';
        resultBox.classList.remove('impostor');
      }
      
      checkGameEnd();
    }

    // Verificar fin de juego
    function checkGameEnd() {
      const activeImpostors = gameState.impostorIndexes.filter(i => !gameState.eliminated.includes(i));
      const activePlayers = gameState.players.filter((p, i) => !gameState.eliminated.includes(i));
      
      const statusText = document.getElementById('game-status-text');
      const buttons = document.getElementById('result-buttons');
      buttons.innerHTML = '';
      
      if (activeImpostors.length === 0) {
        statusText.textContent = '¡Todos los impostores fueron eliminados!';
        const btn = document.createElement('button');
        btn.className = 'btn btn-primary';
        btn.textContent = 'Ver resultado final';
        btn.onclick = endRound;
        buttons.appendChild(btn);
      } else if (activePlayers.length <= activeImpostors.length) {
        statusText.textContent = '¡Los impostores son mayoría!';
        const btn = document.createElement('button');
        btn.className = 'btn btn-primary';
        btn.textContent = 'Ver resultado final';
        btn.onclick = endRound;
        buttons.appendChild(btn);
      } else {
        statusText.textContent = `Quedan ${activeImpostors.length} impostor(es) activos`;
        
        const activeIndex = gameState.players.findIndex((p, i) => 
          !gameState.eliminated.includes(i) && i > gameState.firstPlayerIndex
        );
        
        if (activeIndex === -1) {
          gameState.firstPlayerIndex = gameState.players.findIndex((p, i) => !gameState.eliminated.includes(i));
        } else {
          gameState.firstPlayerIndex = activeIndex;
        }
        
        const btn = document.createElement('button');
        btn.className = 'btn btn-primary';
        btn.textContent = 'Continuar jugando';
        btn.onclick = continueRound;
        buttons.appendChild(btn);
      }
      
      showScreen('screen-vote-result');
    }

    // Continuar ronda
    function continueRound() {
      gameState.currentPlayerIndex = 0;
      showStartCluesScreen();
    }

    // Terminar ronda
    function endRound() {
      const activeImpostors = gameState.impostorIndexes.filter(i => !gameState.eliminated.includes(i));
      const winnerText = document.getElementById('round-winner-text');
      const summaryText = document.getElementById('round-summary');
      
      if (activeImpostors.length === 0) {
        winnerText.textContent = '¡Ganaron los Ciudadanos!';
        summaryText.textContent = 'Todos los impostores fueron eliminados.';
      } else {
        winnerText.textContent = '¡Ganaron los Impostores!';
        summaryText.textContent = 'Los impostores lograron sobrevivir o alcanzar la mayoría.';
      }
      
      showScreen('screen-end-round');
    }

    // Mostrar opciones para jugar de nuevo
    function showPlayAgainOptions() {
      showScreen('screen-play-again');
    }

    // Repetir todo igual
    function repeatAll() {
      gameState.eliminated = [];
      gameState.firstPlayerIndex = 0;
      assignRoles();
      gameState.currentPlayerIndex = 0;
      showPassPhoneScreen();
    }

    // Cambiar solo categoría
    function changeCategory() {
      const categories = ['mixto', 'comida', 'peliculas', 'lugares', 'objetos'];
      const currentIndex = categories.indexOf(gameState.wordCategory);
      const nextIndex = (currentIndex + 1) % categories.length;
      gameState.wordCategory = categories[nextIndex];
      
      document.getElementById('word-category').value = gameState.wordCategory;
      saveConfig();
      
      repeatAll();
    }

    // Cambiar configuración
    function changeConfig() {
      showScreen('screen-setup');
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
      loadConfig();
      updatePlayerInputs();
    });
  </script>
</body>
</html>
