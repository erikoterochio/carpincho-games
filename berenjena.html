<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CYTN5F1X5W"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-CYTN5F1X5W');
  </script>
  <meta charset="UTF-8" />
  <title>üé≤ Generala ¬∑ Carpincho Games</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="common-styles.css">
  <style>
    /* Estilos espec√≠ficos de Generala */
    body {
      padding-top: 60px;
    }

    .container {
      min-height: calc(100vh - 60px);
      padding: 16px;
    }

    .app {
      max-width: 900px;
    }

    .players-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-input-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .player-input-row input {
      flex: 1;
      padding: 12px 14px;
      border: 2px solid rgba(148, 163, 184, 0.3);
      border-radius: 10px;
      font-size: 1rem;
      background: #ffffff;
    }

    .player-input-row input:focus {
      outline: none;
      border-color: var(--sky);
    }

    .player-input-row .remove-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 2px solid rgba(239, 68, 68, 0.3);
      background: #ffffff;
      color: #ef4444;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .player-input-row .remove-btn:hover {
      background: #fef2f2;
      border-color: #ef4444;
    }

    .add-player-btn {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 2px dashed rgba(148, 163, 184, 0.4);
      background: transparent;
      color: var(--sky);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-top: 8px;
    }

    .add-player-btn:hover {
      border-color: var(--sky);
      background: #f0f9ff;
    }

    .btn-add {
      background: var(--green);
      color: white;
      border: 2px solid var(--green);
    }

    .btn-add:hover {
      background: #45a049;
    }

    /* Tabla de puntajes */
    .table-container {
      overflow-x: auto;
      margin-bottom: 16px;
    }

    .score-table {
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--border);
      width: auto;
      margin: 0 auto;
    }

    .score-table th {
      background: var(--sky);
      color: white;
      padding: 10px 12px;
      font-weight: 600;
      font-size: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
      min-width: 70px;
      position: relative;
    }

    .score-table th.category-header {
      text-align: center;
      min-width: 100px;
      position: sticky;
      left: 0;
      z-index: 12;
      background: var(--sky);
    }

    .score-table td {
      padding: 8px 12px;
      border: 1px solid var(--border);
      text-align: center;
      font-size: 0.95rem;
    }

    .score-table td.category-name {
      text-align: center;
      background: #f8f9fa;
      font-weight: 600;
      color: var(--indigo);
      position: sticky;
      left: 0;
      z-index: 10;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.08);
    }

    .score-table td.score-cell {
      padding: 0;
      position: relative;
    }

    .score-table input {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 600;
      padding: 8px 4px;
      color: var(--text);
    }

    .score-table input:focus {
      outline: none;
      background: #e0f2fe;
    }

    .score-table input.filled {
      background: #dcfce7;
      color: var(--green);
    }

    .score-table input.crossed {
      background: #fee2e2;
      color: var(--red);
    }

    .score-table tr.total-row {
      background: #f8f9fa;
      font-weight: 700;
    }

    .score-table tr.divider-row td {
      border-top: 3px solid var(--sky);
    }

    .score-table tr.total-row td {
      border-top: 3px solid var(--sky);
      font-size: 1rem;
      color: var(--sky);
      padding: 10px 12px;
    }

    .score-table tr.total-row td.category-name {
      background: #f8f9fa;
    }

    .player-header {
      position: relative;
    }

    .delete-player-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      border: none;
      font-size: 0.7rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
      opacity: 0.8;
      transition: all 0.15s ease;
    }

    .delete-player-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .app {
        padding: 16px;
      }

      .score-table th,
      .score-table td {
        font-size: 0.85rem;
        padding: 6px 8px;
      }

      .score-table th {
        min-width: 60px;
      }

      .score-table th.category-header {
        min-width: 90px;
      }
    }
  </style>
</head>
<body>
  <div class="fixed-header">
    <div class="christmas-lights">
      <img src="gorro.png" alt="">
    </div>
    <div class="header-content">
      <div class="header-title">Generala</div>
      <a href="index.html" class="home-btn">‚Üê Inicio</a>
    </div>
  </div>

  <div class="container">
    <main class="app">
      <!-- PANTALLA 1: INICIO -->
      <div id="splashScreen" class="screen active">
        <div class="content">
          <p class="intro-text">
            Anotador para el cl√°sico juego de dados argentino.
          </p>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="startNewGame()">Nuevo juego</button>
            <button id="resumeBtn" class="btn btn-secondary" onclick="resumeGame()" style="display: none;">Reanudar juego</button>
          </div>
        </div>
      </div>

      <!-- PANTALLA 2: CONFIGURACI√ìN -->
      <div id="setupScreen" class="screen">
        <div class="content">
          <div class="form-group">
            <label>Jugadores</label>
            <div class="players-list" id="players-list"></div>
            <button type="button" class="add-player-btn" onclick="addPlayerSetup()">+ Agregar jugador</button>
          </div>

          <button class="btn btn-primary" onclick="startGame()">Empezar</button>
        </div>
      </div>

      <!-- PANTALLA 3: JUEGO -->
      <div id="gameScreen" class="screen">
        <div class="table-container">
          <table class="score-table" id="scoreTable">
            <!-- La tabla se genera din√°micamente -->
          </table>
        </div>

        <div class="btn-group">
          <button class="btn btn-add" onclick="addPlayerDuringGame()">+ Agregar Jugador</button>
          <button class="btn btn-secondary" onclick="backToMenu()">Volver al Men√∫</button>
        </div>
      </div>

      <footer>
        <span>Carpincho Games ¬∑ üé≤ Generala</span>
      </footer>
    </main>
  </div>

  <script>
    let gameState = {
      players: [],
      scores: {}
    };

    let playerCounter = 0;

    const categories = [
      { id: '1', name: '1' },
      { id: '2', name: '2' },
      { id: '3', name: '3' },
      { id: '4', name: '4' },
      { id: '5', name: '5' },
      { id: '6', name: '6' },
      { id: 'escalera', name: 'Escalera' },
      { id: 'full', name: 'Full' },
      { id: 'poker', name: 'P√≥ker' },
      { id: 'generala', name: 'Generala' },
      { id: 'doble', name: 'Doble' }
    ];

    window.onload = function() {
      checkForSavedGame();
    };

    function checkForSavedGame() {
      const saved = localStorage.getItem('generalaGame');
      if (saved) {
        document.getElementById('resumeBtn').style.display = 'block';
      }
    }

    function saveGame() {
      localStorage.setItem('generalaGame', JSON.stringify(gameState));
    }

    function resumeGame() {
      const saved = localStorage.getItem('generalaGame');
      if (saved) {
        gameState = JSON.parse(saved);
        showScreen('gameScreen');
        renderTable();
      }
    }

    function startNewGame() {
      if (localStorage.getItem('generalaGame')) {
        if (!confirm('Esto va a borrar tu partida guardada. ¬øContinuar?')) {
          return;
        }
      }
      localStorage.removeItem('generalaGame');
      gameState = {
        players: [],
        scores: {}
      };
      playerCounter = 0;
      showScreen('setupScreen');
      initializePlayers();
    }

    function initializePlayers() {
      const container = document.getElementById('players-list');
      container.innerHTML = '';
      
      for (let i = 0; i < 2; i++) {
        addPlayerSetup();
      }
    }

    function addPlayerSetup() {
      const container = document.getElementById('players-list');
      const index = playerCounter++;
      
      const row = document.createElement('div');
      row.className = 'player-input-row';
      row.id = `player-row-${index}`;
      row.innerHTML = `
        <input type="text" placeholder="Jugador ${index + 1}" id="player-${index}" />
        <button type="button" class="remove-btn" onclick="removePlayerSetup(${index})">√ó</button>
      `;
      
      container.appendChild(row);
    }

    function removePlayerSetup(index) {
      const row = document.getElementById(`player-row-${index}`);
      if (row) {
        row.remove();
      }
    }

    function startGame() {
      gameState.players = [];
      gameState.scores = {};
      
      const playerRows = document.querySelectorAll('.player-input-row');
      playerRows.forEach((row, i) => {
        const input = row.querySelector('input');
        const name = input.value.trim() || `Jugador ${i + 1}`;
        gameState.players.push(name);
        
        gameState.scores[name] = {};
        categories.forEach(cat => {
          gameState.scores[name][cat.id] = '';
        });
      });
      
      if (gameState.players.length < 1) {
        alert('Necesit√°s al menos 1 jugador');
        return;
      }
      
      saveGame();
      showScreen('gameScreen');
      renderTable();
    }

    function addPlayerDuringGame() {
      const name = prompt('Nombre del nuevo jugador:');
      if (!name || name.trim() === '') return;
      
      const playerName = name.trim();
      
      // Verificar que no exista
      if (gameState.players.includes(playerName)) {
        alert('Ya existe un jugador con ese nombre');
        return;
      }
      
      // Agregar jugador
      gameState.players.push(playerName);
      
      // Inicializar scores vac√≠os
      gameState.scores[playerName] = {};
      categories.forEach(cat => {
        gameState.scores[playerName][cat.id] = '';
      });
      
      saveGame();
      renderTable();
    }

    function removePlayerDuringGame(player) {
      if (!confirm(`¬øEliminar a ${player}?`)) return;
      
      // Eliminar del array de jugadores
      gameState.players = gameState.players.filter(p => p !== player);
      
      // Eliminar scores
      delete gameState.scores[player];
      
      saveGame();
      renderTable();
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    function renderTable() {
      const table = document.getElementById('scoreTable');
      let html = '<thead><tr>';
      
      html += '<th class="category-header">Categor√≠a</th>';
      gameState.players.forEach(player => {
        html += `<th class="player-header">
          ${player}
          <button class="delete-player-btn" onclick="removePlayerDuringGame('${player}')" title="Eliminar jugador">√ó</button>
        </th>`;
      });
      html += '</tr></thead><tbody>';
      
      // Todas las categor√≠as
      categories.forEach((cat, index) => {
        const isDivider = index === 6; // Escalera es la posici√≥n 6 (despu√©s del 6)
        html += `<tr${isDivider ? ' class="divider-row"' : ''}>`;
        html += `<td class="category-name">${cat.name}</td>`;
        gameState.players.forEach(player => {
          const value = gameState.scores[player][cat.id];
          const displayValue = value === 0 ? 'X' : (value || '');
          const inputClass = value === 0 ? 'crossed' : (value && value !== '' ? 'filled' : '');
          
          // Permitir siempre editar doble (se puede tachar aunque no tenga generala)
          const isDisabled = false;
            
          html += `<td class="score-cell">
            <input 
              type="text" 
              inputmode="numeric" 
              pattern="[0-9XxSs]*" 
              value="${displayValue}" 
              class="${inputClass}"
              onchange="updateScore('${player}', '${cat.id}', this.value)"
              ${isDisabled ? 'disabled style="opacity:0.3;"' : ''}
            />
          </td>`;
        });
        html += '</tr>';
      });
      
      // Total
      html += '<tr class="total-row">';
      html += '<td class="category-name">TOTAL</td>';
      gameState.players.forEach(player => {
        const total = calculateTotal(player);
        html += `<td>${total}</td>`;
      });
      html += '</tr>';
      
      html += '</tbody>';
      table.innerHTML = html;
    }

    function updateScore(player, categoryId, value) {
      // Permitir X, x, S, s para tachar (0), o n√∫meros
      value = value.trim().toUpperCase();
      
      if (value === 'X' || value === 'S') {
        gameState.scores[player][categoryId] = 0;
      } else if (value === '') {
        gameState.scores[player][categoryId] = '';
      } else {
        // Filtrar solo n√∫meros
        const numValue = value.replace(/[^0-9]/g, '');
        if (numValue !== '') {
          gameState.scores[player][categoryId] = parseInt(numValue);
        } else {
          gameState.scores[player][categoryId] = '';
        }
      }
      
      saveGame();
      renderTable();
    }

    function calculateTotal(player) {
      let total = 0;
      let hasValues = false;
      
      categories.forEach(cat => {
        const value = gameState.scores[player][cat.id];
        if (value !== '' && !isNaN(value)) {
          total += parseInt(value);
          hasValues = true;
        }
      });
      
      return hasValues ? total : '';
    }

    function backToMenu() {
      showScreen('splashScreen');
      checkForSavedGame();
    }
  </script>
</body>
</html>
